@startuml RenovIUTApp

skinparam style strictuml
skinparam classAttributeIconSize 0
skinparam classFontStyle Bold
hide enum methods

class RenovIUTApp
{
    + {static} main(args: String[])
}

package global {
    class DBManager
    {
    	+ db : SQLite
    	+ db_path : String
    	+ _init DBManager(path : String)
    	+ open_db() : Boolean
    	+ close_db()
    	+ execute(query : String, params : Array) : Boolean
    	+ get_entries(query : String, params : Array) : Array
    	+ clear_tables()
    }

    class Glob
    {
    	+ {static} normal_inflation_rate : Real
    	+ {static} indexation_rate : Real
    	+ {static} db : DBManager
    	+ {static} ok : Boolean
    	+ {static} dept_string_to_index(dept : String) : Integer
    	+ {static} dept_index_to_string(index : Integer) : String
    	+ {static} source_string_to_index(dept : String) : Integer
    	+ {static} source_index_to_string(index : Integer) : String
    }
}

package views
{
    package nodes
    {
        class BuildingView
        {
            - selected : String
            + view_options()
            + hire_teachers()
            + fire_teachers()
            + heating_on()
            + heating_off()
            + hire_maintenance_agents()
            + fire_maintenance_agents()
            + launch_action()
            + view_building_info()
        }

        class Stats
        {
            + view_budget()
            + view_satisfaction()
            + view_teacher_satisfaction()
            + view_student_satisfaction()
            + view_student_success()
        }

        class Reaction
        {
            - reactions : String[*]
            - selected : Integer
            + _init Reaction()
            + define_reaction(selected : Integer)
            + send_reaction(selected : Integer)

        }
    }

    package scenes
    {
        class Start
        {
            + view_start_screen()
            + select_scenario()
            + launch_game()
        }

        class Menu
        {
            + view_menu()
            + start(scenario: Scenario)
            + quit()
        }

        class GameOver
        {
            + view_gameover()
            + replay()
        }
    }
}





package controllers
{
		package timeline
        {
			class TimeManagement
			{
				+ _init(scenario: Scenario)
				+ tick()
                + wait(time : Real)
                + end_of_month()
				+ end_of_year()
                + year_begin()
				+ pause(p : Boolean)
			}

            abstract class Scenario
		    {
                - name : String
                + {abstract} _init()
            	+ {abstract} test_end_game_condition() : Boolean
                + {abstract} end_game()
				+ {abstract} random_event()
                + {abstract} init_data()
                + init_building()
				+ get_name() : String
                + {abstract} {static} get_description() : String

				+ adjust_budget(coeff : Real)
				+ adjust_student_satisfaction(coeff : Real)
				+ adjust_teacher_satisfaction(coeff : Real)
				+ adjust_call_probability(call : Integer, coeff : Real)
				+ adjust_dept_state(dept: String, coeff : Real)
		    }

            class ScenarioElection
            {
             + {static} get_description() : String
            }

            class ScenarioRenovation
            {
             + {static} get_description() : String
            }

			class Vote
			{
                + {static} nb_voix_per_dept(dept: String) : int
                + {static} nb_voix_teacher_per_dept(dept: String) : int
                + {static} nb_voix_student_per_dept(dept: String) : int
                + {static} nb_voix_teacher() : int
                + {static} nb_voix_student() : int
                + {static} nb_voix_total() : int
				+ {static} election_gagnee() : Boolean
				+ {static} popularity_rate() : Real
				+ {static} popularity_rate_per_dept(dept : String) : Real
				+ {static} popularity_rate_among_teachers() : Real
				+ {static} popularity_rate_among_teachers_per_dept(dept : String) : Real
				+ {static} popularity_rate_among_students() : Real
				+ {static} popularity_rate_among_students_per_dept(dept : String) : Real
			}
    }

    package school
    {
        class Teaching
        {
            + {static} hire_teachers(dept : String)
            + {static} fire_teachers(dept : String)
            + {static} populate()
            + {static} boost_satisfaction_teacher(dept : String, value : float)
            + {static} drop_satisfaction_teacher(dept : String, value : float)
        }

        class Study
        {
            + {static} populate()
            + {static} populate_promo(dept : String, year : Integer)
            + {static} evaluate()
            + {static} next_year()
            + {static} boost_satisfaction_student(dept : String, value : float)
            + {static} drop_satisfaction_student(dept : String, value : float)
            + {static} boost_level_student(dept : String, value : float)
            + {static} drop_level_student(dept : String, value : float)
        }
    }

    package management
    {
        class BuildingManagement
        {
            + {static} switchHeat(dept : String)
            + {static} fireAgent(dept : String)
            + {static} hireAgent(dept : String)
            + {static} lockDoor(dept : String)
            + {static} unlockDoor(dept : String)
        }


        class Financing
        {
            + finance(dept : String)
            + finance(dept : String, destination : String)
            + finance(destination : String)
            + update_budget()
        }

        abstract class Action
        {
            + planify_action()
        }

        class Planified
        {
            + planify_for_next_year()
        }

        class Urgent
        {
            + respond_to_urgent()
        }
    }

    abstract class Event 
    {
        - _question : bool
        - _name : String
        - _description : String
        - _question_script : String
        - _question_answer : Array[String] 
        + {static} create_event(id : Event) : Event
        + _init()
        + start_event() : void
        + {abstract} react_to_answer(answer : String) : void
        + get_question() : bool
        + get_name() : String
        + get_description() : String
        + get_question_script() : String
        + get_question_answer() : Array[String]
    }

    class _question
    {
        + ask_question_event(_event : Event)
    }


}





package models
{
    class globalData
    {
        - {static} _year : Integer
		- {static} _month : Integer
		- {static} _day : Integer
        - {static} _budget : Integer
        - {static} difficulty : Integer
        + {static} setBudget(montant : Integer)
        + {static} addBudget(montant : Integer)
        + {static} getBudget() : Integer
        + {static} setDate(day,month,year)
        + {static} incrementDay()
        + {static} isNewMonth() : Boolean
        + {static} isEndofYear() : Boolean
        + {static} isStartofYear() : Boolean
        + {static} get_season() : Integer

        + {static} get_difficulty() : Integer
        + {static} set_difficulty() : Integer
        + {static} adjust_budget_initial() : Integer
        + {static} adjust_fund() : Real
		+ {static} adjust_satisfaction() : Real
		+ {static} adjust_level() : Real
		+ {static} adjust_dept_state() : Real
        + {static} adjust_event_proba() : Real

    }

	package human {
		class Students
		{
                + {static} get_all_ids() : Array
                + {static} get_dept_ids() : Array
				+ {static} add_student(dept : String, year: Integer)
				+ {static} rm_student(id : Integer)
				+ {static} rm_students_by_dept(dept : String, nb : Integer)
				+ {static} get_year(id : Integer) : Integer
				+ {static} get_dept(id : Integer) : String
				+ {static} get_mood(id : Integer) : Real
				+ {static} get_level(id : Integer) : Real
				+ {static} set_year(id : Integer, year : Integer)
				+ {static} set_mood(id : Integer, coeff : Real)
				+ {static} set_level(id : Integer, coeff : Real)
				+ {static} compute_nb_per_dept(dept : String) : Real
				+ {static} avg_mood_per_dept(dept : String) : Real
				+ {static} compute_nb() : Real
				+ {static} avg_mood() : Real
				+ {static} success_rate_per_dept(dept : String) : Real
				+ {static} success_rate() : Real
		}
		class Teachers
		{
                + {static} get_all_ids() : Array
                + {static} get_dept_ids() : Array
				+ {static} add_teacher(dept : String, full_time : Boolean)
				+ {static} rm_teacher(id : Integer)
				+ {static} rm_teachers_by_dept(dept : String, nb : Integer)
				+ {static} get_dept(id : Integer) : String
				+ {static} get_mood(id : Integer) : Real
				+ {static} get_if_fulltime(id : Integer) : Boolean
				+ {static} set_mood(id : Integer, coeff : Real)
				+ {static} set_fulltime(id : Integer, status : Boolean)
				+ {static} compute_nb_per_dept(dept : String) : Real
				+ {static} avg_mood_per_dept(dept : String) : Real
				+ {static} compute_nb() : Real
				+ {static} avg_mood() : Real
		}
        class StudentSQLTable
        {
            + id : Integer <<PK>>
            + year : Integer [1..3]
            + dept : String
            + mood : Real [0, 1]
            + level : Real [0, 1]
        }
        class TeacherSQLTable
        {
            + id : Integer <<PK>>
            + dept : String
            + mood : Real [0, 1]
            + full-time : Boolean
        }

    }

		package material
        {
			class Building
			{
				- _age : Integer
                - _doorLocked : Boolean
				- _surface : Integer
				- _heating : Boolean
				- _maintenance_agents_nb : Integer
                - _code : String
                - _isolation : Integer[0..100]
                - _inventory : integer[0..100]
                + _init(age, isolation, surface, heating, maintenance_agents_nb, code, inventory)
                + {static} get_building(code : String) : Building
			    + get_code() : String
                + get_age() : int
                + get_isolation() : int
                + get_surface() : int
                + is_heating() : bool
                + get_agents_nb() : int
                + add_agent()
                + rm_agent()
                + setHeat(heat : Boolean)
                + setIsolation(value : Integer)
                + setInventory(value : Integer)
                + addIsolation(value : Integer)
                + addInventory(value : Integer)
                + isDoorLocked() : Boolean
                + setDoorLocked(locked : Boolean)
			}

			class Fund
			{
				+ add_fund(source : String, amount : Real, destination : String?, time : Integer)
				+ rm_fund_by_id(i : Integer)
			    + rm_fund_by_source(source : String)
				+ get_source(id : Integer) : String
				+ get_amount(id : Integer) : Real
				+ get_area(id : Integer) : String?
				+ get time(id : Integer) : Integer
				+ set_area(id : Integer, dest : String)
				+ set_time(id : Integer, time : Integer)
				+ total() : Real
				+ total_per_dept(dept : String) : Real
				+ inflation_adjusted(indexation_rate : Real)
				+ normal_inflation_adjusted()
				+ check_availability(amount : Real, dest : String) : Boolean
				+ forecast() : Real
			}

			class Call
			{
				+ get_message(id : Integer) : String
				+ get_duration(id : Integer) : Integer
				+ get_if_reproductible(id : Integer) : Boolean
				+ get_if_needs_action(id : Integer) : Boolean
				+ get_area(id : Integer) : String
				+ set_area(id : Integer, another_place : String)
			}

            class FundSQLTable
            {
                + id : Integer <<PK>>
                + amount : Real
                + source : String
                + area : String
                + time : Integer
            }

            class NotificationSQLTable
            {
                + id : Integer <<PK>>
                + message : String
                + duration : Integer
                + is_reproductible : Boolean
                + needs_action : Boolean
                + area : String
            }


            class DeptSQLTable
            {
                + id : Integer <<PK>>
                + name : String
            }

            class SourceSQLTable
            {
                + id : Integer <<PK>>
                + name : String
            }

    }
}




'Appli'
RenovIUTApp ...> views
RenovIUTApp .> Glob
Glob *--> DBManager

'Vue utilise modèle'
BuildingView ...> Building
Stats ....> models

'Vue utilise controller'
GameOver ..> Vote
Reaction o--> Action
Menu ..> Scenario

'Controller utilse modèle'
Study ..> Students
Teaching ..> Teachers
Financing ..> Fund
Action *---> Building
Action *--> Call
Action *--> Event
BuildingManagement ..> Building
TimeManagement ..> global_data

'Modèle utilise SQL'
Students ..> StudentSQLTable
Teachers ..> TeacherSQLTable
Fund ....> FundSQLTable
Call ....> NotificationSQLTable
TeacherSQLTable ..> DeptSQLTable
StudentSQLTable ..> DeptSQLTable
FundSQLTable ..> DeptSQLTable
NotificationSQLTable ..> DeptSQLTable
FundSQLTable ..> SourceSQLTable
Event ..> ChoiceSQLTable
Event ..> EventSQLTable
Event ..> ConsequencesSQLTable

'Heritage'
Action -|> Urgent
Action -|> Planified
Scenario --|> ScenarioElection
Scenario --|> ScenarioRenovation

'Autre'
TimeManagement *--> Scenario
Financing ..> Scenario
Building o--> Building



@enduml

